#!/bin/sh

is_installed(){
	if ! [ -x "$(command -v $1)" ]; then
	  echo "Error: $1 is not installed." >&2
	  exit 1
	fi
}

check_requirements(){
	# Check if sudo, curl and openvpn are installed
	is_installed sudo
	is_installed curl
	is_installed openvpn
}

check_requirements

default_dir=${HOME}/.local/scripts
mkdir -p ${default_dir}
cmd="(sleep 20 && ${default_dir}/vpnbook_wrapper -s US1) &"

echo "Copying Script under ${HOME}/.local/scripts..."
cp vpnbook_wrapper ${default_dir}
chmod 744 ${default_dir}/vpnbook_wrapper
cp vpnbook.config ${default_dir}

cp vpnbook ${default_dir}
chmod 744 ${default_dir}/vpnbook
cp vpnbook_stop ${default_dir}
chmod 744 ${default_dir}/vpnbook_stop
cp password_extractor ${default_dir}
chmod 744 ${default_dir}/password_extractor

if grep -Fxq "${cmd}" ${HOME}/.config/openbox/autostart.sh
then
	echo "No need to add vpnbook to autostart.sh as it is already present"
else
	echo "Adding VPN Book to autostart.sh..."
	echo ${cmd} >> ${HOME}/.config/openbox/autostart.sh
fi

echo "In order to work, the User: $USER must be part of a group called vpnstarter. Add the following lines to your sudoers configuration file..."
echo '## Members of the Group vpnstarter can run openvpn'
echo '%vpnstarter ALL=(ALL) PASSWD: /usr/local/sbin/openvpn'
